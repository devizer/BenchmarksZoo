  

steps:

  - bash: |
      mono --version
      dotnet --info
      curl -sSL https://dot.net/v1/dotnet-install.sh | sudo bash /dev/stdin -c 3.1 -i /usr/share/dotnet
      dotnet --info


      script=https://raw.githubusercontent.com/devizer/test-and-build/master/install-build-tools.sh; (wget -q -nv --no-check-certificate -O - $script 2>/dev/null || curl -ksSL $script) | bash
      Say "Memory"
      free -m
      echo ""

      Say "CPU"
      lscpu
      echo ""

      Say "All Hardware"
      sudo lshw
      echo ""

      Say "Block Devices"
      sudo fdisk -l
      echo ""

      Say "Mount Volumes"
      df -h -T
      echo ""


  - bash: |
      Say "Install LLVM"
      wget -O /tmp/llvm.sh https://apt.llvm.org/llvm.sh
      sudo bash /tmp/llvm.sh $LLVM
    displayName: 'Install LLVM'

  - bash: |
      # --Release?
      bash run-llvm.sh --Release | tee $BUILD_ARTIFACTSTAGINGDIRECTORY/Full-Log.txt
      ls -la BenchmarksZoo/bin/Release/net47/BenchmarkDotNet.Artifacts/results
      cp -a BenchmarksZoo/bin/Release/net47/BenchmarkDotNet.Artifacts/results/* $BUILD_ARTIFACTSTAGINGDIRECTORY
    displayName: 'Benchmark all'

  - bash: |
        list-packages
    displayName: 'list packages 1'

  - bash: |
        list-packages
    displayName: 'list packages 2'

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: 'Benchmark Report (LLVM $(LLVM))'
